apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Values.externalSecrets.secretName }}
spec:
  replicas: 1
  selector:
    matchLabels:
      app: {{ .Values.externalSecrets.secretName }}
  template:
    metadata:
      labels:
        app: {{ .Values.externalSecrets.secretName }}
    spec:
      containers:
      - name: alpine
        image: alpine:latest
        command: ["/bin/sh", "-c"]
        args: ["while true; do echo hello; sleep 10; done"]


---


apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: app-secret    # The name of the ExternalSecret resource in Kubernetes
spec:
  refreshInterval: 1m  # Frequency of how often the secret is synchronized from the external store
  secretStoreRef:
    name: global-secret-store  # Name of the external secret store (e.g., AWS Secrets Manager, HashiCorp Vault)
    kind: ClusterSecretStore   # Refers to a cluster-wide secret store type
  target:
    name: .Values.externalSecrets.secretName       # Name of the Kubernetes secret that will be created/updated
    creationPolicy: Owner      # Ownership policy. "Owner" means if the ExternalSecret is deleted, the target secret will also be deleted
  dataFrom:
    - extract:
        key: prod/secret     # The key (or secret name) in the external secret store from which all key-value pairs will be extracted
